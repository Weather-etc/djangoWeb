{% extends "robot_base.html" %} {% block msgbox %}

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

</head>
<div class="msg-container"
       data-width="100%"
       id="msg_container"
       style="overflow: scroll; width: 100%; height: 792px; overflow-x: hidden; overflow-y: hidden">
          <!-- insert here -->

      <div class="home-center">
        <div class="home-border">
        <div class="home-filter">
        <input
          type="text"
          placeholder="Destination"
          class="home-textinput input"
          id="text_input"
        />

        <div class="home-search"
             id="home-search"
            onclick="showMsg();sendMsg();">
          <img
            alt="image"
            src="../static/chatBot/public/Icons/search.svg"
            class="home-icon"
          />
        </div>
      </div>
    </div>
  </div>
</div>

    <script type="text/javascript">
    function showMsg() {
        let res = [{{ response|safe }}];
        let send_message = document.getElementById("msg_container");
        let message = document.getElementById("text_input");
        // show msg sent
        let str = message.value;
        let date = new Date();
        let hour = date.getHours();
        let mm = date.getMinutes();
        let time = hour + ':' + mm;
        let ans = '<div class="chat_right_item_1 clearfix">热巴</div>' +
            '<div class="chat_right_item_2">' +
            '<div class="chat_right_time clearfix">' + time + '</div>' +
            '<div class="chat_right_content clearfix">' + str + '</div>'
            + '</div>';
        let oLi = document.createElement("div");
        oLi.setAttribute("class", "chat_right");
        oLi.innerHTML = ans;
        send_message.append(oLi);
    }
    function showMsg_robot(msg){
        let send_message = document.getElementById("msg_container");
        // get response from robot

        let date = new Date();
        let hour = date.getHours();
        let mm = date.getMinutes();
        let time = hour + ':' + mm;
        let res_html = '<div class="chat_left_item_1 clearfix">robot</div>' +
            '<div class="chat_left_item_2">' +
            '<div class="chat_left_time clearfix">' + time + '</div>' +
            '<div class="chat_left_content clearfix">' + msg + '</div>' +
            '</div>';
        let res_entity = document.createElement("div");
        res_entity.setAttribute("class", "class_left");
        res_entity.innerHTML = res_html;
        send_message.append(res_entity);

        document.getElementById('text_input').value = '';
    }
    </script>

    <script type="text/javascript">
        const ws_protocol = (window.location.protocol == "https:") ? 'wss://': 'ws://';
        const chat_socket = new WebSocket(
            ws_protocol + window.location.host + '/ws/chat/'
        );
        // chat_socket.onopen = function(){};
        chat_socket.onmessage = showMsg_robot;
        // chat_socket.onclose = function (){};

        // send msg to backend
        function sendMsg(){
            const msg_box = document.getElementById("text_input");
            let msg = msg_box.value;
            chat_socket.send(JSON.stringify({
                "message": msg
            }));
            msg_box.value = "";
        }
    </script>
{% endblock %}